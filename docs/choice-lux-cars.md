
# ğŸš— Choice Lux Cars App

## ğŸ“Œ Purpose

**Choice Lux Cars** is a professional mobile-first application designed to streamline operations for a luxury car rental company. The app enables seamless interaction between admins, managers, and drivers to manage jobs, track vehicles, and ensure high-quality service delivery with integrated quote, invoice, and voucher generation.

The main objective is to digitize and automate booking workflows, ensure real-time updates, and enhance customer and team communication across roles.

---

## ğŸ› ï¸ Features

### ğŸ” Authentication & Roles
- Supabase Auth with role-based access:
  - **Admin**
  - **Manager**
  - **Driver**
  - **Driver Manager**
- Firebase FCM push notification support
- Post-login FCM token validation and update

---

### ğŸ“¦ Job Management
- Admins/Managers can:
  - Create, assign, and update jobs
  - Upload photos for pickup/dropoff
- Drivers can:
  - View assigned jobs
  - Update job status
  - Upload job completion images

---

### ğŸ§¾ Quote & Voucher Generation
- Generate PDF quotes:
  - Branded layout
  - Line items (car, rates, extras)
  - Terms & Conditions
- Generate vouchers:
  - Modified version of quotes
  - No pricing or T&Cs

All PDFs are uploaded to Supabase Storage with public URLs linked to each job/quote.

---

### ğŸ§© Supabase Integration
- Key tables:
  - `quote_details`
  - `quotes_transport_details`
  - `order_details`
  - `profiles` (with `role` and `fcm_token`)
- Row-level security (RLS) for secure access control
- Storage for job-related files and documents

---

### ğŸ”” Notifications
- FCM integrated via Firebase and Supabase Edge Functions
- Role-based push notifications:
  - e.g. notify Driver when job is assigned
- Auto-update FCM token post-login using FlutterFlow custom action

---

### ğŸ‘¤ Client & Car Management
- Reusable data:
  - Client profiles
  - Car configurations and packages
- Tag trips as corporate, private, or recurring

---

### ğŸ“± Mobile-First UX
- Designed for phones using FlutterFlow (migrating to Flutter)
- Optimized for drivers on-the-go
- Future phase: offline sync support

---

## âœ… Final App Goals

### ğŸ§± Stack
- Flutter + Riverpod
- Supabase (Auth, Storage, Database, RLS)
- Firebase Cloud Messaging
- GoRouter + Material 3

### ğŸ’¡ Outcomes
- Role-based dashboards and experiences
- Clean, responsive UI with Material 3
- Integrated PDF workflows
- Secure, real-time job management
- Push notifications to drive team efficiency

---

## ğŸ“‚ Folder Structure (Recommended)

```
lib/
â”œâ”€â”€ app/                # App-level config (theme, router, etc.)
â”œâ”€â”€ features/
â”‚   â”œâ”€â”€ auth/
â”‚   â”œâ”€â”€ jobs/
â”‚   â”œâ”€â”€ quotes/
â”‚   â””â”€â”€ vouchers/
â”œâ”€â”€ shared/
â”‚   â”œâ”€â”€ widgets/
â”‚   â””â”€â”€ utils/
â””â”€â”€ main.dart
```

---

## ğŸ”„ Migration Notes
The app is being rebuilt in Flutter with clean architecture. Existing functionality from FlutterFlow will be carefully refactored, optimized, and enhanced using modern best practices.



---

## ğŸ“¦ Current Project Structure (FlutterFlow Export)

This project originated in FlutterFlow and includes:

- `lib/flutter_flow/` â€“ autogenerated widgets and utilities (should be deleted)
- `lib/custom_code/` â€“ contains reusable custom actions like:
  - `generate_quote_pdf.dart`, `update_fcm_after_login.dart`, etc.
- `lib/backend/supabase/tables/` â€“ table schema models
- `lib/features/` â€“ grouped features like:
  - `quotes/`, `jobs/`, `invoices/`, `vouchers/`, `vehicles/`, `clients/`
- `assets/` â€“ organized into images, videos, fonts, PDFs
- `firebase/` â€“ cloud functions, config, and rules

---

## ğŸ§¹ Migration Strategy (FlutterFlow â†’ Clean Flutter)

You should start with a **new Flutter project** using:

- **Flutter** (v3.22+)
- **Riverpod** (v2+)
- **GoRouter**
- **Supabase** (Auth, Storage, Database)
- **Firebase FCM**
- **Material 3 theming**

Delete:
- `lib/flutter_flow/`
- All `*_model.dart` files
- Any obsolete FF page wrappers

---

## ğŸš€ New App Architecture (Riverpod + Clean Architecture)

### Folder Structure:

```plaintext
lib/
â”œâ”€â”€ app/                
â”‚   â”œâ”€â”€ app.dart             # Root widget with ProviderScope
â”‚   â”œâ”€â”€ theme.dart           # Material 3 theming setup
â”‚   â”œâ”€â”€ router.dart          # GoRouter configuration
â”‚   â””â”€â”€ providers.dart       # Global providers
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ constants.dart       # Global constants and enums
â”‚   â”œâ”€â”€ utils.dart           # Helpers (formatters, etc.)
â”‚   â””â”€â”€ services/            # Supabase, Firebase, PDF, Notifications
â”‚       â”œâ”€â”€ supabase_service.dart
â”‚       â”œâ”€â”€ pdf_service.dart
â”‚       â”œâ”€â”€ fcm_service.dart
â”‚       â””â”€â”€ auth_service.dart
â”œâ”€â”€ features/
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â””â”€â”€ signup/
â”‚   â”œâ”€â”€ clients/
â”‚   â”œâ”€â”€ quotes/
â”‚   â”œâ”€â”€ jobs/
â”‚   â”œâ”€â”€ invoices/
â”‚   â”œâ”€â”€ vehicles/
â”‚   â”œâ”€â”€ notifications/
â”‚   â””â”€â”€ vouchers/
â”œâ”€â”€ shared/
â”‚   â”œâ”€â”€ widgets/             # Shared buttons, fields, layouts
â”‚   â””â”€â”€ layout/              # Responsive wrappers for web/mobile
â””â”€â”€ main.dart
```

---

## âœ… Requirements to Build the App

### ğŸŒ Platform Support

- âœ… **Android**
- âœ… **Web** (mobile & desktop layout switching with MediaQuery + LayoutBuilder)

---

### ğŸ” Authentication
- Supabase Auth
- `profiles` table with roles: `admin`, `manager`, `driver`, `driver_manager`
- Auto-login handling via `supabase_flutter`
- On login:
  - Check and update missing `fcm_token`

---

### ğŸ”” Push Notifications
- Firebase Cloud Messaging
- Supabase Edge Function to trigger FCM
- Flutter-side setup with:
  - Permission check
  - Token update on login
  - `FirebaseMessaging.onMessage.listen(...)` for foreground

---

### ğŸ“„ PDF Workflow
- `pdf` + `printing` packages
- Generate: Quote, Invoice, Voucher PDFs
- Upload to Supabase Storage
- Save public URL to DB
- View or share PDF from the app

---

### ğŸ“Š Feature Modules to Rebuild

#### 1. **Quotes**
- Add, edit, delete quotes
- Line items with description, qty, price, VAT toggle
- Quote preview + download PDF
- Client association
- Quote photos (stored in Supabase Storage)

#### 2. **Jobs**
- Create job from accepted quote
- Assign to driver
- Track job status
- Upload pickup/delivery photos

#### 3. **Invoices**
- Generate invoice from job
- PDF generation
- Client summary view

#### 4. **Clients**
- Add/edit clients
- Contacts and addresses
- View client dashboard

#### 5. **Vehicles**
- Add/edit vehicles
- Assign vehicles to jobs/quotes

#### 6. **User Management**
- Admin view of users
- Assign roles
- Update profile

#### 7. **Dashboard**
- Admin: see open/closed jobs, invoices, etc.
- Driver: view assigned jobs
- Manager: monitor fleet activity

#### 8. **Vouchers**
- Generated like quotes but without pricing/terms
- Use same PDF flow with minimal logic override

---

## ğŸ“± UI & Theming

- Full Material 3 support
- Custom `TradeTrackTheme` or `ChoiceLuxTheme`
- Responsive layout via `LayoutBuilder`
- Shared `ScaffoldWrapper` to adjust padding & layout

---

## ğŸ§ª Testing & CI/CD

- `flutter_test`
- GitHub Actions or Codemagic for CI
- Firebase Hosting (web build)
- Supabase CLI for migrations and edge functions

---

## ğŸ§  Next Steps

- [ ] Scaffold new project
- [ ] Implement Riverpod + theme + routing
- [ ] Rebuild client/quote/job modules
- [ ] Integrate PDF & notifications
- [ ] Final testing and deployment

