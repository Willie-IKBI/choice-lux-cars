
# 🚗 Choice Lux Cars App

## 📌 Purpose

**Choice Lux Cars** is a professional mobile-first application designed to streamline operations for a luxury car rental company. The app enables seamless interaction between admins, managers, and drivers to manage jobs, track vehicles, and ensure high-quality service delivery with integrated quote, invoice, and voucher generation.

The main objective is to digitize and automate booking workflows, ensure real-time updates, and enhance customer and team communication across roles.

---

## 🛠️ Features

### 🔐 Authentication & Roles
- Supabase Auth with role-based access:
  - **Admin**
  - **Manager**
  - **Driver**
  - **Driver Manager**
- Firebase FCM push notification support
- Post-login FCM token validation and update

---

### 📦 Job Management
- Admins/Managers can:
  - Create, assign, and update jobs
  - Upload photos for pickup/dropoff
- Drivers can:
  - View assigned jobs
  - Update job status
  - Upload job completion images

---

### 🧾 Quote & Voucher Generation
- Generate PDF quotes:
  - Branded layout
  - Line items (car, rates, extras)
  - Terms & Conditions
- Generate vouchers:
  - Modified version of quotes
  - No pricing or T&Cs

All PDFs are uploaded to Supabase Storage with public URLs linked to each job/quote.

---

### 🧩 Supabase Integration
- Key tables:
  - `quote_details`
  - `quotes_transport_details`
  - `order_details`
  - `profiles` (with `role` and `fcm_token`)
- Row-level security (RLS) for secure access control
- Storage for job-related files and documents

---

### 🔔 Notifications
- FCM integrated via Firebase and Supabase Edge Functions
- Role-based push notifications:
  - e.g. notify Driver when job is assigned
- Auto-update FCM token post-login using FlutterFlow custom action

---

### 👤 Client & Car Management
- Reusable data:
  - Client profiles
  - Car configurations and packages
- Tag trips as corporate, private, or recurring

---

### 📱 Mobile-First UX
- Designed for phones using FlutterFlow (migrating to Flutter)
- Optimized for drivers on-the-go
- Future phase: offline sync support

---

## ✅ Final App Goals

### 🧱 Stack
- Flutter + Riverpod
- Supabase (Auth, Storage, Database, RLS)
- Firebase Cloud Messaging
- GoRouter + Material 3

### 💡 Outcomes
- Role-based dashboards and experiences
- Clean, responsive UI with Material 3
- Integrated PDF workflows
- Secure, real-time job management
- Push notifications to drive team efficiency

---

## 📂 Folder Structure (Recommended)

```
lib/
├── app/                # App-level config (theme, router, etc.)
├── features/
│   ├── auth/
│   ├── jobs/
│   ├── quotes/
│   └── vouchers/
├── shared/
│   ├── widgets/
│   └── utils/
└── main.dart
```

---

## 🔄 Migration Notes
The app is being rebuilt in Flutter with clean architecture. Existing functionality from FlutterFlow will be carefully refactored, optimized, and enhanced using modern best practices.



---

## 📦 Current Project Structure (FlutterFlow Export)

This project originated in FlutterFlow and includes:

- `lib/flutter_flow/` – autogenerated widgets and utilities (should be deleted)
- `lib/custom_code/` – contains reusable custom actions like:
  - `generate_quote_pdf.dart`, `update_fcm_after_login.dart`, etc.
- `lib/backend/supabase/tables/` – table schema models
- `lib/features/` – grouped features like:
  - `quotes/`, `jobs/`, `invoices/`, `vouchers/`, `vehicles/`, `clients/`
- `assets/` – organized into images, videos, fonts, PDFs
- `firebase/` – cloud functions, config, and rules

---

## 🧹 Migration Strategy (FlutterFlow → Clean Flutter)

You should start with a **new Flutter project** using:

- **Flutter** (v3.22+)
- **Riverpod** (v2+)
- **GoRouter**
- **Supabase** (Auth, Storage, Database)
- **Firebase FCM**
- **Material 3 theming**

Delete:
- `lib/flutter_flow/`
- All `*_model.dart` files
- Any obsolete FF page wrappers

---

## 🚀 New App Architecture (Riverpod + Clean Architecture)

### Folder Structure:

```plaintext
lib/
├── app/                
│   ├── app.dart             # Root widget with ProviderScope
│   ├── theme.dart           # Material 3 theming setup
│   ├── router.dart          # GoRouter configuration
│   └── providers.dart       # Global providers
├── core/
│   ├── constants.dart       # Global constants and enums
│   ├── utils.dart           # Helpers (formatters, etc.)
│   └── services/            # Supabase, Firebase, PDF, Notifications
│       ├── supabase_service.dart
│       ├── pdf_service.dart
│       ├── fcm_service.dart
│       └── auth_service.dart
├── features/
│   ├── auth/
│   │   ├── login/
│   │   └── signup/
│   ├── clients/
│   ├── quotes/
│   ├── jobs/
│   ├── invoices/
│   ├── vehicles/
│   ├── notifications/
│   └── vouchers/
├── shared/
│   ├── widgets/             # Shared buttons, fields, layouts
│   └── layout/              # Responsive wrappers for web/mobile
└── main.dart
```

---

## ✅ Requirements to Build the App

### 🌐 Platform Support

- ✅ **Android**
- ✅ **Web** (mobile & desktop layout switching with MediaQuery + LayoutBuilder)

---

### 🔐 Authentication
- Supabase Auth
- `profiles` table with roles: `admin`, `manager`, `driver`, `driver_manager`
- Auto-login handling via `supabase_flutter`
- On login:
  - Check and update missing `fcm_token`

---

### 🔔 Push Notifications
- Firebase Cloud Messaging
- Supabase Edge Function to trigger FCM
- Flutter-side setup with:
  - Permission check
  - Token update on login
  - `FirebaseMessaging.onMessage.listen(...)` for foreground

---

### 📄 PDF Workflow
- `pdf` + `printing` packages
- Generate: Quote, Invoice, Voucher PDFs
- Upload to Supabase Storage
- Save public URL to DB
- View or share PDF from the app

---

### 📊 Feature Modules to Rebuild

#### 1. **Quotes**
- Add, edit, delete quotes
- Line items with description, qty, price, VAT toggle
- Quote preview + download PDF
- Client association
- Quote photos (stored in Supabase Storage)

#### 2. **Jobs**
- Create job from accepted quote
- Assign to driver
- Track job status
- Upload pickup/delivery photos

#### 3. **Invoices**
- Generate invoice from job
- PDF generation
- Client summary view

#### 4. **Clients**
- Add/edit clients
- Contacts and addresses
- View client dashboard

#### 5. **Vehicles**
- Add/edit vehicles
- Assign vehicles to jobs/quotes

#### 6. **User Management**
- Admin view of users
- Assign roles
- Update profile

#### 7. **Dashboard**
- Admin: see open/closed jobs, invoices, etc.
- Driver: view assigned jobs
- Manager: monitor fleet activity

#### 8. **Vouchers**
- Generated like quotes but without pricing/terms
- Use same PDF flow with minimal logic override

---

## 📱 UI & Theming

- Full Material 3 support
- Custom `TradeTrackTheme` or `ChoiceLuxTheme`
- Responsive layout via `LayoutBuilder`
- Shared `ScaffoldWrapper` to adjust padding & layout

---

## 🧪 Testing & CI/CD

- `flutter_test`
- GitHub Actions or Codemagic for CI
- Firebase Hosting (web build)
- Supabase CLI for migrations and edge functions

---

## 🧠 Next Steps

- [ ] Scaffold new project
- [ ] Implement Riverpod + theme + routing
- [ ] Rebuild client/quote/job modules
- [ ] Integrate PDF & notifications
- [ ] Final testing and deployment

